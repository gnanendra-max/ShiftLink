<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShiftLink | Real-Time Job Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Slate 50 */
            color: #334155; /* Slate 700 */
        }
        .header {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #e2e8f0; /* Slate 200 */
        }
        .cta-button {
            transition: all 0.2s ease;
            background-image: linear-gradient(to right, #f59e0b, #fbbf24);
            color: #422006; /* Amber 950 */
            border-radius: 0.5rem;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
        }
        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 25px rgba(245, 158, 11, 0.3);
        }
        .cta-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .secondary-button {
             background-color: #e2e8f0; /* Slate 200 */
             color: #475569; /* Slate 600 */
             border-radius: 0.5rem;
        }
        .secondary-button:hover {
            background-color: #cbd5e1; /* Slate 300 */
        }
        .job-card, .choice-card, .referral-card {
            background-color: #ffffff; /* White */
            border: 1px solid #e2e8f0; /* Slate 200 */
            border-radius: 0.75rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }
        .job-card:hover, .choice-card:hover, .referral-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.08);
            border-color: #f59e0b; /* Amber 500 */
        }
        .input-field {
            background-color: #f8fafc; /* Slate 50 */
            border: 1px solid #cbd5e1; /* Slate 300 */
            color: #1e293b; /* Slate 800 */
            border-radius: 0.5rem;
        }
        .input-field:focus {
            --tw-ring-color: #f59e0b;
            border-color: #f59e0b;
        }
        .hero-gradient {
            background: #f8fafc;
            background: linear-gradient(145deg, #fefce8 0%, #f8fafc 100%);
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="antialiased">

    <!-- Main Application Container -->
    <div id="app-container" class="min-h-screen">

        <!-- Header -->
        <header class="header sticky top-0 z-40">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-slate-800 cursor-pointer" id="home-button">Shift<span class="text-amber-500">Link</span></h1>
                <div id="user-info" class="hidden items-center space-x-4">
                     <button id="refer-job-button" class="font-semibold text-slate-600 hover:text-amber-500">Refer a Job</button>
                    <span id="user-role-display" class="font-semibold text-slate-600 capitalize"></span>
                    <button id="logout-button" class="text-sm text-slate-500 hover:text-amber-500">Logout</button>
                </div>
            </nav>
        </header>

        <!-- Loading Spinner -->
        <div id="loading-spinner" class="fixed inset-0 bg-white/70 z-50 flex items-center justify-center">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-amber-500"></div>
        </div>

        <!-- Role Selection View (Logged Out) -->
        <div id="role-selection-view" class="hidden hero-gradient">
             <div class="container mx-auto px-6 py-20 md:py-28 text-center">
                <h2 class="text-4xl md:text-6xl font-extrabold text-slate-800 leading-tight mb-6">
                    Stop Searching. <br class="hidden md:block"> Start Connecting.
                </h2>
                <p class="max-w-3xl mx-auto text-lg md:text-xl text-slate-500 mb-12">
                   Finding flexible work or reliable part-time talent shouldn't be a struggle. We built ShiftLink to bridge this gap, instantly connecting skilled professionals with great companies for part-time and project-based roles. This is the future of work, simplified.
                </p>
                <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <div id="select-seeker-button" class="choice-card cursor-pointer p-8 rounded-xl text-left">
                        <h3 class="text-2xl font-bold text-slate-800 mt-4 mb-2">Find a Job</h3>
                        <p class="text-slate-500">Discover flexible jobs from local businesses and companies.</p>
                        <p class="font-semibold text-amber-600 mt-4">Start Your Search →</p>
                    </div>
                     <div id="select-employer-button" class="choice-card cursor-pointer p-8 rounded-xl text-left">
                        <h3 class="text-2xl font-bold text-slate-800 mt-4 mb-2">Hire Talent</h3>
                        <p class="text-slate-500">Post a job in minutes and find reliable candidates for your team.</p>
                        <p class="font-semibold text-amber-600 mt-4">Post a Job for Free →</p>
                    </div>
                </div>
                 <div class="mt-12">
                     <button id="select-referrer-button" class="font-semibold text-slate-600 hover:text-amber-500">Or, refer a job and earn rewards →</button>
                 </div>
            </div>
        </div>

        <!-- Job Seeker View -->
        <div id="seeker-view" class="hidden container mx-auto px-6 py-12">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                 <h2 class="text-3xl font-bold text-slate-800">Available Jobs</h2>
                 <div class="relative w-full md:w-1/3">
                    <input type="text" id="search-input" placeholder="Search 'Data Entry', 'IT Support', 'Barista'..." class="w-full pl-4 pr-10 py-3 rounded-lg focus:ring-2 input-field">
                    <svg class="absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>
                 </div>
            </div>
            <div id="job-listings-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
             <div id="no-jobs-message" class="hidden text-center py-16 bg-white rounded-lg">
                <p class="text-xl text-slate-500">No jobs have been posted yet.</p>
                <p class="mt-2 text-slate-400">Check back soon!</p>
            </div>
             <div id="no-search-results-message" class="hidden text-center py-16 bg-white rounded-lg">
                <p class="text-xl text-slate-500">No jobs match your search.</p>
            </div>
        </div>

        <!-- Employer View -->
        <div id="employer-view" class="hidden container mx-auto px-6 py-12">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-slate-800">Your Job Postings</h2>
                <button id="open-post-job-modal-button" class="cta-button font-bold rounded-lg px-6 py-3">Post a New Job</button>
            </div>
            <div id="employer-jobs-container" class="space-y-4"></div>
            <div id="no-employer-jobs-message" class="hidden text-center py-16 bg-white rounded-lg">
                <p class="text-xl text-slate-500">You haven't posted any jobs yet.</p>
            </div>
        </div>

        <!-- Admin View -->
        <div id="admin-view" class="hidden container mx-auto px-6 py-12">
            <h2 class="text-3xl font-bold text-slate-800 mb-8">Referred Job Leads</h2>
            <div id="referral-listings-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            <div id="no-referrals-message" class="hidden text-center py-16 bg-white rounded-lg">
                <p class="text-xl text-slate-500">No new job leads have been referred.</p>
            </div>
        </div>

    </div>

    <!-- Modals -->
    <div id="post-job-modal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4"></div>
    <div id="refer-job-modal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4"></div>

    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, where, onSnapshot, updateDoc, arrayUnion, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- App Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "your-fallback-api-key", authDomain: "your-fallback-auth-domain", projectId: "your-fallback-project-id" };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const ADMIN_UID = "YOUR_ADMIN_UID_HERE"; // IMPORTANT: Replace with your actual Firebase User ID

        // --- Firebase Initialization ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- DOM Elements ---
        const loadingSpinner = document.getElementById('loading-spinner');
        const roleSelectionView = document.getElementById('role-selection-view');
        const seekerView = document.getElementById('seeker-view');
        const employerView = document.getElementById('employer-view');
        const adminView = document.getElementById('admin-view');
        const userInfo = document.getElementById('user-info');
        const userRoleDisplay = document.getElementById('user-role-display');
        const jobListingsContainer = document.getElementById('job-listings-container');
        const employerJobsContainer = document.getElementById('employer-jobs-container');
        const referralListingsContainer = document.getElementById('referral-listings-container');
        
        // Buttons
        const homeButton = document.getElementById('home-button');
        const selectSeekerButton = document.getElementById('select-seeker-button');
        const selectEmployerButton = document.getElementById('select-employer-button');
        const selectReferrerButton = document.getElementById('select-referrer-button');
        const logoutButton = document.getElementById('logout-button');
        const referJobButton = document.getElementById('refer-job-button');
        
        // Modals
        const postJobModalContainer = document.getElementById('post-job-modal');
        const referJobModalContainer = document.getElementById('refer-job-modal');

        // Search
        const searchInput = document.getElementById('search-input');

        let currentUser = null;
        let userRole = null;
        let allJobs = [];
        let jobsUnsubscribe = null;
        let employerJobsUnsubscribe = null;
        let referralsUnsubscribe = null;

        // --- UI Management ---
        function showView(view) {
            [loadingSpinner, roleSelectionView, seekerView, employerView, adminView, userInfo].forEach(el => el.style.display = 'none');
            if (view === 'loading') loadingSpinner.style.display = 'flex';
            if (view === 'roleSelection') roleSelectionView.style.display = 'block';
            if (['seeker', 'employer', 'admin'].includes(view)) {
                document.getElementById(`${view}-view`).style.display = 'block';
                userInfo.style.display = 'flex';
            }
        }

        // --- Authentication ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                if (currentUser.uid === ADMIN_UID) {
                    userRole = 'admin';
                    userRoleDisplay.textContent = 'Admin';
                    showView('admin');
                    listenForReferrals();
                    return;
                }
                
                const userDocRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}`);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    userRole = userDoc.data().role;
                    userRoleDisplay.textContent = userRole;
                    if (userRole === 'seeker') {
                        showView('seeker');
                        listenForJobs();
                    } else if (userRole === 'employer') {
                        showView('employer');
                        fetchEmployerJobs();
                    }
                } else {
                    showView('roleSelection');
                }
            } else {
                currentUser = null;
                userRole = null;
                [jobsUnsubscribe, employerJobsUnsubscribe, referralsUnsubscribe].forEach(unsub => unsub && unsub());
                showView('roleSelection');
            }
        });

        async function handleRoleSelection(role) {
            showView('loading');
            try {
                if (!auth.currentUser) {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                }
                const user = auth.currentUser;
                const userDocRef = doc(db, `artifacts/${appId}/users/${user.uid}`);
                await setDoc(userDocRef, { role: role });
            } catch (error) {
                console.error("Error during role selection:", error);
                showView('roleSelection');
            }
        }

        // --- Event Listeners ---
        selectSeekerButton.addEventListener('click', () => handleRoleSelection('seeker'));
        selectEmployerButton.addEventListener('click', () => handleRoleSelection('employer'));
        selectReferrerButton.addEventListener('click', () => openReferralModal());
        logoutButton.addEventListener('click', () => signOut(auth));
        homeButton.addEventListener('click', () => {
             if (currentUser && userRole) {
                showView(userRole);
             } else {
                showView('roleSelection');
             }
        });
        referJobButton.addEventListener('click', () => openReferralModal());

        // --- Job Functions ---
        function createJobCard(job, isEmployerView = false) {
            const card = document.createElement('div');
            card.className = 'job-card p-6 rounded-lg flex flex-col border-t-4 border-amber-400';
            const applicationsCount = job.applications ? job.applications.length : 0;
            card.innerHTML = `
                <div class="flex-grow">
                    <h3 class="text-xl font-bold text-slate-800">${job.title}</h3>
                    <p class="text-md text-slate-600 font-semibold mt-1">${job.companyName}</p>
                    <div class="flex items-center text-sm text-slate-500 mt-2 gap-4">
                        <span>📍 ${job.location}</span>
                        <span>🕒 ${job.hours}</span>
                        <span class="font-bold text-amber-700">${job.pay}</span>
                    </div>
                    <p class="text-slate-500 my-4">${job.description}</p>
                </div>
                ${isEmployerView ? `<div class="text-right font-bold text-amber-600 mt-4">${applicationsCount} Application(s)</div>` : `<button data-job-id="${job.id}" class="apply-button w-full mt-4 font-bold py-2 cta-button">Apply Now</button>`}`;
            if (!isEmployerView) {
                card.querySelector('.apply-button').addEventListener('click', async (e) => {
                    e.target.disabled = true;
                    e.target.textContent = 'Applying...';
                    await applyForJob(job.id);
                    e.target.textContent = 'Applied!';
                });
            }
            return card;
        }

        function displayJobs(jobs, container, noMessageId) {
            container.innerHTML = '';
            const noMsg = document.getElementById(noMessageId);
            if (jobs.length === 0) {
                noMsg.style.display = 'block';
            } else {
                noMsg.style.display = 'none';
                jobs.forEach(job => container.appendChild(createJobCard(job, noMessageId === 'no-employer-jobs-message')));
            }
        }

        function listenForJobs() {
            if (jobsUnsubscribe) jobsUnsubscribe();
            const q = query(collection(db, `artifacts/${appId}/public/data/jobs`));
            jobsUnsubscribe = onSnapshot(q, (snapshot) => {
                allJobs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                displayJobs(allJobs, jobListingsContainer, 'no-jobs-message');
            });
        }
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredJobs = allJobs.filter(job => 
                (job.title && job.title.toLowerCase().includes(searchTerm)) ||
                (job.companyName && job.companyName.toLowerCase().includes(searchTerm)) ||
                (job.location && job.location.toLowerCase().includes(searchTerm))
            );
            displayJobs(filteredJobs, jobListingsContainer, 'no-search-results-message');
        });

        function fetchEmployerJobs() {
            if (!currentUser) return;
            if (employerJobsUnsubscribe) employerJobsUnsubscribe();
            const q = query(collection(db, `artifacts/${appId}/public/data/jobs`), where("postedBy", "==", currentUser.uid));
            employerJobsUnsubscribe = onSnapshot(q, (snapshot) => {
                const employerJobs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                displayJobs(employerJobs, employerJobsContainer, 'no-employer-jobs-message');
            });
        }

        async function applyForJob(jobId) {
            if (!currentUser) return;
            const jobDocRef = doc(db, `artifacts/${appId}/public/data/jobs/${jobId}`);
            await updateDoc(jobDocRef, { applications: arrayUnion(currentUser.uid) });
        }
        
        // --- Modal Functions ---
        function openJobPostModal(referral = null) {
            postJobModalContainer.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-lg no-scrollbar overflow-y-auto max-h-full">
                    <h3 class="text-2xl font-bold mb-6 text-slate-800">Post a New Job</h3>
                    <form id="post-job-form" class="space-y-4">
                        <input type="hidden" id="referral-id" value="${referral ? referral.id : ''}">
                        <div><label for="job-title" class="block text-sm font-medium text-slate-600">Job Title</label><input type="text" id="job-title" required class="mt-1 w-full px-4 py-2 rounded-lg focus:ring-2 input-field" value="${referral ? (referral.details || '') : ''}"></div>
                        <div><label for="company-name" class="block text-sm font-medium text-slate-600">Organization / Business Name</label><input type="text" id="company-name" required class="mt-1 w-full px-4 py-2 rounded-lg focus:ring-2 input-field" value="${referral ? (referral.shopName || '') : ''}"></div>
                        <div><label for="job-location" class="block text-sm font-medium text-slate-600">Location</label><input type="text" id="job-location" required class="mt-1 w-full px-4 py-2 rounded-lg focus:ring-2 input-field" value="${referral ? (referral.location || '') : ''}"></div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label for="job-pay" class="block text-sm font-medium text-slate-600">Pay Rate</label><input type="text" id="job-pay" required class="mt-1 w-full px-4 py-2 rounded-lg focus:ring-2 input-field"></div>
                            <div><label for="job-hours" class="block text-sm font-medium text-slate-600">Work Hours</label><input type="text" id="job-hours" required class="mt-1 w-full px-4 py-2 rounded-lg focus:ring-2 input-field"></div>
                        </div>
                        <div><label for="job-description" class="block text-sm font-medium text-slate-600">Job Description</label><textarea id="job-description" rows="4" required class="mt-1 w-full px-4 py-2 rounded-lg focus:ring-2 input-field"></textarea></div>
                        <div class="flex justify-end space-x-4 pt-4">
                            <button type="button" class="cancel-button px-6 py-2 rounded-lg font-semibold secondary-button">Cancel</button>
                            <button type="submit" class="px-6 py-2 rounded-lg font-semibold cta-button">Post Job</button>
                        </div>
                    </form>
                </div>`;
            postJobModalContainer.style.display = 'flex';
            postJobModalContainer.querySelector('.cancel-button').addEventListener('click', () => postJobModalContainer.style.display = 'none');
            postJobModalContainer.querySelector('#post-job-form').addEventListener('submit', handleJobPostSubmit);
        }

        async function handleJobPostSubmit(e) {
            e.preventDefault();
            if(!currentUser) return;
            const jobData = {
                title: document.getElementById('job-title').value,
                companyName: document.getElementById('company-name').value,
                location: document.getElementById('job-location').value,
                pay: document.getElementById('job-pay').value,
                hours: document.getElementById('job-hours').value,
                description: document.getElementById('job-description').value,
                postedBy: currentUser.uid,
                createdAt: new Date(),
                applications: []
            };
            await addDoc(collection(db, `artifacts/${appId}/public/data/jobs`), jobData);
            
            const referralId = document.getElementById('referral-id').value;
            if (referralId) {
                await deleteDoc(doc(db, `artifacts/${appId}/public/data/referrals/${referralId}`));
            }
            
            postJobModalContainer.style.display = 'none';
        }

        function openReferralModal() {
            referJobModalContainer.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-lg">
                    <h3 class="text-2xl font-bold mb-6 text-slate-800">Refer a Job Lead</h3>
                    <form id="refer-job-form" class="space-y-4">
                        <div><label for="refer-shop-name" class="block text-sm font-medium text-slate-600">Organization / Business Name</label><input type="text" id="refer-shop-name" required class="mt-1 w-full px-4 py-2 rounded-lg focus:ring-2 input-field"></div>
                        <div><label for="refer-location" class="block text-sm font-medium text-slate-600">Location</label><input type="text" id="refer-location" required class="mt-1 w-full px-4 py-2 rounded-lg focus:ring-2 input-field"></div>
                        <div><label for="refer-details" class="block text-sm font-medium text-slate-600">Details (e.g., "Hiring cashier, saw sign")</label><textarea id="refer-details" rows="3" required class="mt-1 w-full px-4 py-2 rounded-lg focus:ring-2 input-field"></textarea></div>
                        <div class="flex justify-end space-x-4 pt-4">
                            <button type="button" class="cancel-button px-6 py-2 rounded-lg font-semibold secondary-button">Cancel</button>
                            <button type="submit" class="px-6 py-2 rounded-lg font-semibold cta-button">Submit Referral</button>
                        </div>
                    </form>
                </div>`;
            referJobModalContainer.style.display = 'flex';
            referJobModalContainer.querySelector('.cancel-button').addEventListener('click', () => referJobModalContainer.style.display = 'none');
            referJobModalContainer.querySelector('#refer-job-form').addEventListener('submit', handleReferralSubmit);
        }

        async function handleReferralSubmit(e) {
            e.preventDefault();
            const referralData = {
                shopName: document.getElementById('refer-shop-name').value,
                location: document.getElementById('refer-location').value,
                details: document.getElementById('refer-details').value,
                referredAt: new Date(),
                status: 'pending'
            };
            await addDoc(collection(db, `artifacts/${appId}/public/data/referrals`), referralData);
            referJobModalContainer.style.display = 'none';
            alert('Thank you! Your referral has been submitted.');
        }

        // --- Admin Functions ---
        function listenForReferrals() {
            if (referralsUnsubscribe) referralsUnsubscribe();
            const q = query(collection(db, `artifacts/${appId}/public/data/referrals`));
            referralsUnsubscribe = onSnapshot(q, (snapshot) => {
                referralListingsContainer.innerHTML = '';
                document.getElementById('no-referrals-message').style.display = snapshot.empty ? 'block' : 'none';
                snapshot.forEach(doc => {
                    const referral = { id: doc.id, ...doc.data() };
                    referralListingsContainer.appendChild(createReferralCard(referral));
                });
            });
        }

        function createReferralCard(referral) {
            const card = document.createElement('div');
            card.className = 'referral-card p-6 rounded-lg';
            card.innerHTML = `
                <h3 class="text-lg font-bold text-slate-800">${referral.shopName}</h3>
                <p class="text-sm text-slate-500">${referral.location}</p>
                <p class="text-slate-600 my-3">${referral.details}</p>
                <button class="confirm-button w-full font-bold py-2 cta-button">Confirm & Post Job</button>`;
            card.querySelector('.confirm-button').addEventListener('click', () => openJobPostModal(referral));
            return card;
        }

        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('open-post-job-modal-button').addEventListener('click', () => openJobPostModal());
        });

    </script>
</body>
</html>
